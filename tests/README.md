# Yandex Transport Proxy - Tests

–ü—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–≤–∞ —Ç–∏–ø–∞ —Ç–µ—Å—Ç–æ–≤:

## Unit Tests (–±—ã—Å—Ç—Ä—ã–µ, ~0.2 —Å–µ–∫—É–Ω–¥—ã)

**–§–∞–π–ª:** `test_preload_cache.py`

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∫—ç—à–∞
- ‚úÖ –õ–æ–≥–∏–∫–∞ TTL
- ‚úÖ –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–∫–æ–Ω—Ü–µ–ø—Ç—ã)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∞–º–∏ (–ª–æ–≥–∏–∫–∞)
- ‚úÖ –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏

**–ó–∞–ø—É—Å–∫:**
```bash
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
python tests/test_preload_cache.py

# –ò–ª–∏ —á–µ—Ä–µ–∑ pytest
pytest tests/test_preload_cache.py -v
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Ran 21 tests in 0.176s
OK
```

---

## Integration Tests (–º–µ–¥–ª–µ–Ω–Ω—ã–µ, 30+ —Å–µ–∫—É–Ω–¥)

**–§–∞–π–ª:** `test_preload_integration.py`

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:**
- üî¥ –†–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ Chrome/Selenium
- üî¥ –ó–∞–≥—Ä—É–∑–∫–∞ Yandex.Maps
- üî¥ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
- üî¥ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞
- üî¥ End-to-end —Ç–µ—Å—Ç—ã
- üî¥ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ó–∞–≥–ª—É—à–∫–∏ (skipped)**

–≠—Ç–∏ —Ç–µ—Å—Ç—ã —Ç—Ä–µ–±—É—é—Ç:
1. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ `transport_proxy.py` (—Å–µ–π—á–∞—Å —ç—Ç–æ —Å–∫—Ä–∏–ø—Ç, –∞ –Ω–µ –º–æ–¥—É–ª—å)
2. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ Chrome/ChromeDriver
3. –°–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ yandex.ru
4. ~30+ —Å–µ–∫—É–Ω–¥ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

**–ó–∞–ø—É—Å–∫ (–≤—Å–µ —Ç–µ—Å—Ç—ã –±—É–¥—É—Ç skip):**
```bash
python tests/test_preload_integration.py --run-slow
```

---

## –ü–æ—á–µ–º—É unit —Ç–µ—Å—Ç—ã –±—ã—Å—Ç—Ä—ã–µ?

**Unit —Ç–µ—Å—Ç—ã** –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ç–æ–ª—å–∫–æ **–ª–æ–≥–∏–∫—É –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö** –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±—Ä–∞—É–∑–µ—Ä–æ–º. –≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥:

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ unit —Ç–µ—Å—Ç–æ–≤:
- ‚ö° **–ë—ã—Å—Ç—Ä—ã–µ** (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã)
- üîÑ **–ù–∞–¥–µ–∂–Ω—ã–µ** (–Ω–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç —Å–µ—Ç–∏/–±—Ä–∞—É–∑–µ—Ä–∞)
- üéØ **–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ** (—Ç–µ—Å—Ç–∏—Ä—É—é—Ç –æ–¥–∏–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
- üîß **–õ–µ–≥–∫–æ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å**
- ‚úÖ **–ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤–µ–∑–¥–µ** (CI/CD, –ª–æ–∫–∞–ª—å–Ω–æ)

### –ö–æ–≥–¥–∞ –Ω—É–∂–Ω—ã integration —Ç–µ—Å—Ç—ã:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Chrome
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- End-to-end —Å—Ü–µ–Ω–∞—Ä–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

---

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–æ–≤

| –¢–∏–ø | –§–∞–π–ª | –¢–µ—Å—Ç—ã | –í—Ä–µ–º—è | –°—Ç–∞—Ç—É—Å |
|-----|------|-------|-------|--------|
| Unit | `test_transport_proxy.py` | 3 | ~0.1s | ‚úÖ Pass |
| Unit | `test_yandex_transport_core.py` | 3 | ~0.1s | ‚úÖ Pass |
| Unit | `test_preload_cache.py` | 21 | ~0.2s | ‚úÖ Pass |
| Integration | `test_preload_integration.py` | 12 | N/A | ‚ö†Ô∏è Skipped |

**–í—Å–µ–≥–æ:** 27 unit —Ç–µ—Å—Ç–æ–≤ (–≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç), 12 integration –∑–∞–≥–ª—É—à–µ–∫

---

## –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö unit —Ç–µ—Å—Ç–æ–≤

```bash
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
python tests/test_transport_proxy.py
python tests/test_yandex_transport_core.py
python tests/test_preload_cache.py

# –ò–ª–∏ —á–µ—Ä–µ–∑ pytest (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
pytest tests/ -v -k "not integration"
```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–π—Ç–µ **unit —Ç–µ—Å—Ç—ã** –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚úÖ –û–Ω–∏ –¥–æ–ª–∂–Ω—ã –≤—Å–µ–≥–¥–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
- ‚ö†Ô∏è Integration —Ç–µ—Å—Ç—ã - –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

### –î–ª—è CI/CD:
```yaml
# .github/workflows/tests.yml
- name: Run unit tests
  run: |
    python tests/test_transport_proxy.py
    python tests/test_yandex_transport_core.py
    python tests/test_preload_cache.py
```

### –î–ª—è Docker:
```bash
# –¢–µ—Å—Ç –≤ —Å–æ–±—Ä–∞–Ω–Ω–æ–º –æ–±—Ä–∞–∑–µ
docker run --rm ytp:latest python3 /home/transport_proxy/tests/test_preload_cache.py
```

---

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

–î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ integration —Ç–µ—Å—Ç–æ–≤ –Ω—É–∂–Ω–æ:

1. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ transport_proxy.py:**
   ```python
   # –°–¥–µ–ª–∞—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–º –º–æ–¥—É–ª–µ–º
   class Application:
       def __init__(self, ...):
           ...
       
       def run(self):
           ...
   
   if __name__ == '__main__':
       app = Application(...)
       app.run()
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å fixtures –¥–ª—è Chrome:**
   ```python
   @pytest.fixture
   def chrome_instance():
       core = YandexTransportCore(verbose=False)
       core.start_webdriver()
       yield core
       core.quit_webdriver()
   ```

3. **–ú–æ–∫–∏ –¥–ª—è Yandex API:**
   ```python
   @mock.patch('selenium.webdriver.Chrome')
   def test_with_mock_chrome(mock_chrome):
       ...
   ```

**–ù–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ 27 unit —Ç–µ—Å—Ç–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!** üéØ
