{
  "title": "Yandex Transport Proxy API Schema",
  "description": "JSON Schema for Yandex Transport Proxy Server API v1.1.0",
  "version": "1.1.0",
  
  "definitions": {
    "queueResponse": {
      "type": "object",
      "description": "Immediate acknowledgment when query is added to queue",
      "properties": {
        "id": {
          "type": "string",
          "description": "Client-supplied request identifier"
        },
        "response": {
          "type": "string",
          "enum": ["OK"],
          "description": "Status of queue insertion"
        },
        "queue_position": {
          "type": "integer",
          "minimum": 0,
          "description": "Position in the query queue (0 = currently executing)"
        }
      },
      "required": ["id", "response", "queue_position"]
    },
    
    "successResponse": {
      "type": "object",
      "description": "Successful API response with data",
      "properties": {
        "id": {
          "type": "string",
          "description": "Client-supplied request identifier"
        },
        "method": {
          "type": "string",
          "enum": [
            "getEcho",
            "getStopInfo",
            "getVehiclesInfo",
            "getVehiclesInfoWithRegion",
            "getRouteInfo",
            "getLine",
            "getLayerRegions"
          ],
          "description": "Yandex Masstransit API method executed"
        },
        "error": {
          "type": "integer",
          "const": 0,
          "description": "Error code (0 = success)"
        },
        "message": {
          "type": "string",
          "enum": ["OK"],
          "description": "Human-readable status message"
        },
        "expect_more_data": {
          "type": "boolean",
          "description": "If true, more responses follow (used in getAllInfo)"
        },
        "data": {
          "description": "Response data (format depends on method)",
          "oneOf": [
            {"type": "string"},
            {"type": "object"},
            {"type": "array"}
          ]
        }
      },
      "required": ["id", "method", "error", "message", "expect_more_data", "data"]
    },
    
    "errorResponse": {
      "type": "object",
      "description": "Error response when query fails",
      "properties": {
        "id": {
          "type": "string",
          "description": "Client-supplied request identifier"
        },
        "method": {
          "type": "string",
          "description": "Method that failed"
        },
        "error": {
          "type": "integer",
          "enum": [1, 2, 3],
          "description": "Error code: 1=no data, 2=get error, 3=no yandex data"
        },
        "message": {
          "type": "string",
          "description": "Human-readable error description"
        },
        "expect_more_data": {
          "type": "boolean",
          "const": false,
          "description": "Always false for errors"
        }
      },
      "required": ["id", "method", "error", "message", "expect_more_data"]
    },
    
    "currentQueueResponse": {
      "type": "object",
      "description": "Response from getCurrentQueue command",
      "properties": {
        "queue": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Array of request IDs in queue"
        },
        "size": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of queries in queue"
        }
      },
      "required": ["queue", "size"]
    },
    
    "stopInfoData": {
      "type": "object",
      "description": "Structure of getStopInfo response data",
      "properties": {
        "data": {
          "type": "object",
          "properties": {
            "properties": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Stop name"
                },
                "StopMetaData": {
                  "type": "object",
                  "properties": {
                    "id": {"type": "string"},
                    "Transport": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "type": "string",
                            "description": "Route name/number"
                          },
                          "id": {"type": "string"},
                          "EstimatedArrivals": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "time": {
                                  "type": "string",
                                  "description": "ISO 8601 timestamp"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    
    "vehiclesInfoData": {
      "type": "object",
      "description": "Structure of getVehiclesInfo response data",
      "properties": {
        "data": {
          "type": "object",
          "properties": {
            "properties": {
              "type": "object",
              "properties": {
                "BoundedBy": {
                  "type": "array",
                  "items": {
                    "type": "array",
                    "items": {"type": "number"}
                  },
                  "description": "Bounding box coordinates"
                },
                "VehicleMetaData": {
                  "type": "object",
                  "properties": {
                    "Vehicles": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {"type": "string"},
                          "coordinates": {
                            "type": "array",
                            "items": {"type": "number"},
                            "minItems": 2,
                            "maxItems": 2,
                            "description": "[longitude, latitude]"
                          },
                          "ThreadMetaData": {
                            "type": "object",
                            "properties": {
                              "id": {"type": "string"},
                              "name": {"type": "string"}
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    
    "routeInfoData": {
      "type": "object",
      "description": "Structure of getRouteInfo response data",
      "properties": {
        "data": {
          "type": "object",
          "properties": {
            "name": {"type": "string"},
            "properties": {
              "type": "object",
              "properties": {
                "RouteMetaData": {
                  "type": "object",
                  "properties": {
                    "id": {"type": "string"},
                    "name": {"type": "string"},
                    "color": {"type": "string"},
                    "type": {
                      "type": "string",
                      "enum": ["bus", "trolleybus", "tramway", "minibus"]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    
    "lineData": {
      "type": "object",
      "description": "Structure of getLine response data (comprehensive route with all stops)",
      "properties": {
        "data": {
          "type": "object",
          "properties": {
            "features": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": {"type": "string"},
                  "geometry": {
                    "type": "object",
                    "properties": {
                      "type": {"type": "string"},
                      "coordinates": {
                        "type": "array",
                        "description": "Array of coordinate pairs for route line"
                      }
                    }
                  },
                  "properties": {
                    "type": "object",
                    "properties": {
                      "name": {"type": "string"},
                      "StopMetaData": {
                        "type": "object",
                        "description": "Metadata for stops along the route"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  
  "oneOf": [
    {"$ref": "#/definitions/queueResponse"},
    {"$ref": "#/definitions/successResponse"},
    {"$ref": "#/definitions/errorResponse"},
    {"$ref": "#/definitions/currentQueueResponse"}
  ],
  
  "examples": [
    {
      "description": "Queue acknowledgment",
      "data": {
        "id": "req001",
        "response": "OK",
        "queue_position": 2
      }
    },
    {
      "description": "Successful getEcho response",
      "data": {
        "id": "test123",
        "method": "getEcho",
        "error": 0,
        "message": "OK",
        "expect_more_data": false,
        "data": "HelloWorld"
      }
    },
    {
      "description": "Successful getStopInfo response",
      "data": {
        "id": "req002",
        "method": "getStopInfo",
        "error": 0,
        "message": "OK",
        "expect_more_data": false,
        "data": {
          "data": {
            "properties": {
              "name": "Метро Войковская",
              "StopMetaData": {
                "id": "stop__9649585",
                "Transport": [
                  {
                    "name": "90",
                    "id": "bus__90",
                    "EstimatedArrivals": [
                      {"time": "2025-01-15T12:34:56.000Z"}
                    ]
                  }
                ]
              }
            }
          }
        }
      }
    },
    {
      "description": "Error response",
      "data": {
        "id": "req003",
        "method": "getStopInfo",
        "error": 2,
        "message": "Failed to load URL",
        "expect_more_data": false
      }
    },
    {
      "description": "getAllInfo first response (expect_more_data=true)",
      "data": {
        "id": "full001",
        "method": "getStopInfo",
        "error": 0,
        "message": "OK",
        "expect_more_data": true,
        "data": {"...": "..."}
      }
    },
    {
      "description": "getAllInfo last response (expect_more_data=false)",
      "data": {
        "id": "full001",
        "method": "getLine",
        "error": 0,
        "message": "OK",
        "expect_more_data": false,
        "data": {"...": "..."}
      }
    },
    {
      "description": "getCurrentQueue response",
      "data": {
        "queue": ["req001", "req002", "req003"],
        "size": 3
      }
    }
  ]
}
